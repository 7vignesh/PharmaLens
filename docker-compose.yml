# ==============================================================================
# PharmaLens Docker Compose Configuration
# ==============================================================================
# Multi-container orchestration for the PharmaLens platform
# 
# Services:
# - client:    React + Vite frontend (port 5173)
# - server:    Node.js + Express backend (port 3001)
# - ai_engine: Python + FastAPI AI engine (port 8000)
#
# Usage:
#   docker-compose up --build        # Build and start all services
#   docker-compose up -d             # Start in detached mode
#   docker-compose logs -f           # Follow logs
#   docker-compose down              # Stop all services
# ==============================================================================

version: '3.8'

services:
  # ===========================================================================
  # Frontend - React + Vite + Tailwind CSS
  # ===========================================================================
  client:
    build:
      context: ./client
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    environment:
      - NODE_ENV=development
      - VITE_API_URL=http://localhost:3001
    volumes:
      - ./client:/app
      - /app/node_modules
    depends_on:
      - server
    networks:
      - pharmalens-network
    restart: unless-stopped

  # ===========================================================================
  # Backend - Node.js + Express
  # ===========================================================================
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - PORT=3001
      - AI_ENGINE_URL=http://ai_engine:8000
      - CLIENT_URL=http://localhost:5173
      - LOG_LEVEL=info
    volumes:
      - ./server:/app
      - /app/node_modules
      - ./server/logs:/app/logs
    depends_on:
      - ai_engine
    networks:
      - pharmalens-network
    restart: unless-stopped

  # ===========================================================================
  # AI Engine - Python + FastAPI
  # ===========================================================================
  ai_engine:
    build:
      context: ./ai_engine
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - DEBUG=false
      - LOG_LEVEL=INFO
      - HOST=0.0.0.0
      - PORT=8000
      - NODE_BACKEND_URL=http://server:3001
      - CLOUD_ENABLED=true
      - LOCAL_ENABLED=true
      # Add your OpenAI API key here for cloud mode
      # - OPENAI_API_KEY=your-key-here
    volumes:
      - ./ai_engine:/app
    networks:
      - pharmalens-network
    restart: unless-stopped

# =============================================================================
# Networks
# =============================================================================
networks:
  pharmalens-network:
    driver: bridge

# =============================================================================
# Volumes (for data persistence)
# =============================================================================
volumes:
  server-logs:
    driver: local
